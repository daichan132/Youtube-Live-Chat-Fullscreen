# プロジェクト改善計画

このドキュメントは、YouTube Live Chat Fullscreen 拡張機能のさらなる品質向上と保守性向上のための改善点と考慮事項をまとめたものです。

## 1. テストカバレッジの拡充

*   **現状:** PlaywrightによるE2Eテストは存在しますが、ユニットテストやコンポーネントテストが不足しています。
*   **課題:** 複雑なロジックを持つカスタムフック (`shared/hooks`, `entrypoints/content/hooks`) や再利用可能なUIコンポーネント (`shared/components`) の単体での動作保証が十分ではありません。リファクタリング時のデグレードリスクがあります。
*   **提案:**
    *   テストフレームワーク（例: Vitest, Jest）とReact Testing Libraryを導入します。
    *   主要なカスタムフックに対してユニットテストを作成し、ロジックの正当性を検証します。
    *   汎用的なUIコンポーネントに対してコンポーネントテストを作成し、Propsに応じたレンダリングやインタラクションを検証します。
    *   カバレッジレポートを生成し、テストが不足している箇所を特定・改善します。

## 2. エラーハンドリングの強化

*   **現状:** コード全体での統一的なエラーハンドリング戦略が明示されていません。
*   **課題:** 非同期処理（例: `storage` APIアクセス、iframeとの通信）、外部要因（例: YouTube側のUI変更）、予期せぬユーザー操作などに対するエラー処理が不十分な場合、拡張機能が不安定になったり、ユーザーに問題が伝わらなかったりする可能性があります。
*   **提案:**
    *   主要な非同期処理やエラーが発生しうる箇所に `try...catch` や Promise の `.catch()` を適切に配置します。
    *   ユーザーにフィードバックが必要なエラー（例: 設定保存失敗）については、UI上で適切なメッセージを表示する仕組みを検討します。
    *   開発者向けに、コンソールへのエラーログ出力や、必要であればエラーレポーティングツール（例: Sentry）の導入を検討します。
    *   エラーハンドリングに関する基本的な方針や規約をドキュメント化します。

## 3. パフォーマンスの継続的な監視と最適化

*   **現状:** Content Script はYouTubeのページパフォーマンスに影響を与える可能性があります。
*   **課題:** DOM操作の頻度、イベントリスナーの数と処理内容、Reactコンポーネントの不要な再レンダリング、iframeとの通信頻度などがパフォーマンスボトルネックになる可能性があります。特に `watchYouTubeUI` のような監視処理は負荷が高くなる可能性があります。
*   **提案:**
    *   React DevTools Profilerやブラウザの開発者ツール（Performanceタブ）を使用して、レンダリングパフォーマンスやスクリプト実行時間を定期的に計測します。
    *   `React.memo`, `useMemo`, `useCallback` を適切に使用し、不要な再レンダリングを抑制します。
    *   DOM操作やイベントリスナーは必要最小限にし、不要になったリスナーは適切に解除します。
    *   `requestAnimationFrame` や `Intersection Observer` などを活用し、処理のタイミングを最適化します。
    *   Zustandの `useShallow` を活用し、ストア更新時の不要なコンポーネント再レンダリングを防ぎます。

## 4. アクセシビリティ (a11y) の向上

*   **現状:** Biomeによる基本的なa11yルールチェックは行われていますが、動的なUI要素に対する詳細な検証は不足しています。
*   **課題:** ドラッグ＆ドロップ可能なチャットウィンドウ、カスタムスタイルの適用、設定モーダルなどが、キーボード操作やスクリーンリーダー利用者にとって使いにくい可能性があります。
*   **提案:**
    *   主要なUI要素（スイッチ、スライダー、モーダル、ドラッグハンドルなど）がキーボードのみで操作可能であることを確認します (`Tab` キーでのフォーカス移動、`Enter`/`Space` での操作など）。
    *   スクリーンリーダー（例: VoiceOver, NVDA）を使用して、UI要素の意味や状態が正しく読み上げられるかを確認します。必要に応じて `aria-*` 属性を追加・修正します。
    *   色のコントラスト比がWCAG基準を満たしているか確認します。特にカスタムカラー設定機能において注意が必要です。
    *   Playwrightのアクセシビリティテスト機能などを活用し、自動チェックを導入します。

## 5. `any` 型の削減

*   **現状:** `tsconfig.json` や `biome.json` で `noExplicitAny` が `warn` に設定されており、`any` 型の使用が完全には禁止されていません。
*   **課題:** `any` 型を使用するとTypeScriptの型安全性の恩恵を受けられず、予期せぬランタイムエラーやリファクタリングの困難さを招く可能性があります。
*   **提案:**
    *   コードベース内の `any` 型の使用箇所を特定します。
    *   可能な限り、より具体的な型（`unknown`, Generics, 適切なインターフェースや型エイリアス）に置き換えます。
    *   外部ライブラリで型定義が不足している場合は、`@types` パッケージを探すか、自前で型定義ファイル (`.d.ts`) を作成します。
    *   将来的には `noExplicitAny` ルールを `error` に設定することを目指します。

## 6. 設定ファイルのドキュメント化・簡略化

*   **現状:** 多くの設定ファイルが存在し、それぞれの役割や連携を理解するのに学習コストがかかる可能性があります。
*   **課題:** 新規参画者がプロジェクトの設定全体を把握し、変更を加える際に戸惑う可能性があります。
*   **提案:**
    *   `CODE_DOCUMENTATION.md` や `README.md` に、各設定ファイル (`biome.json`, `tsconfig.json`, `wxt.config.ts`, `uno.config.ts` など）の役割や主要な設定項目についての簡単な説明を追加します。
    *   可能であれば、設定の共通化や簡略化を検討します（ただし、ツールの特性上、ある程度のファイル数は必要になる場合が多い）。

## 7. i18nスクリプトの運用整備

*   **現状:** OpenAI APIを利用する翻訳スクリプトが存在します。
*   **課題:** APIキーの安全な管理方法、利用コスト、実行環境の依存関係（Python, uv）など、運用に関する考慮事項があります。
*   **提案:**
    *   `i18n_scripts/README.md` に、APIキーの設定方法（環境変数など）、スクリプトの実行手順、注意点などを詳細に記載します。
    *   API利用コストを把握し、必要に応じて利用頻度や対象言語を調整する方針を検討します。
    *   スクリプトの実行に必要なPython環境の構築手順を明確にします（`uv` の利用方法など）。

---

これらの改善点に計画的に取り組むことで、プロジェクトの品質、保守性、開発者体験をさらに向上させることができます。
